<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalender â€“ Itschana</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <nav>
    <a href="index.html">Start</a>
    <a href="kalender.html">Kalender</a>
    <a href="webinar.html">Webinar</a>
    <a href="vision.html">Vision</a>
    <a href="kontakt.html">Kontakt</a>
  </nav>

  <main>
    <h1>Kalender der lebendigen Zeit Energien</h1>
    <p>Itschana verbindet den natÃ¼rlichen 273er-Zyklus mit dem gregorianischen Jahreslauf und macht innere Rhythmen erfahrbar.</p>

    <section class="kin-feld">
      <h2>Impuls des heutigen Tages</h2>

      <!-- Ausgabe-Feld (wird durch JSON Loader befÃ¼llt) -->
      <div id="kin-output">Wird geladen â€¦</div>

      <p>
        <a id="kin-link" href="#" target="_blank" rel="noopener">ðŸ”— Zur Tagesenergie Ã¶ffnen</a>
      </p>
    </section>
  </main>

  <section id="spenden" class="spendenbox">
    <h2>FÃ¶rderbeitrag fÃ¼r den NatÃ¼rlichen Kalender 2026</h2>

    <p class="spenden-einleitung">
      Mit einem FÃ¶rderbeitrag von <strong>45&nbsp;Euro</strong> unterstÃ¼tzt du die Entstehung des
      NatÃ¼rlichen Kalenders 2026 â€“ und erhÃ¤ltst den Kalender als Geschenk zugesendet.
    </p>

    <p class="spenden-hinweis">
      <strong>Verwendungszweck:</strong><br>
      â€žNK 2026 â€“ Name + Adresseâ€œ<br>
      <em>(damit wir den Kalender korrekt zusenden kÃ¶nnen)</em>
    </p>

    <div class="spenden-grid">
      <!-- Link-QR (Ã¶ffnet deine Spenden-Webseite) -->
      <div class="spenden-block">
        <h3>Online-Infos & Spendenbereich</h3>
        <p>Dieser QR-Code Ã¶ffnet den Spendenbereich auf itÂ­schana-start:</p>
        <img src="QR_Foerderbeitrag_Itschana_Spenden.png"
             alt="QR-Code zum Spendenbereich Itschana"
             class="qr-code">
        <p class="spenden-klein">
          Alternativ im Browser: <br>
          <code>itschana-start.vercel.app/#spenden</code>
        </p>
      </div>

      <!-- SEPA-QR (Banking-App vorausgefÃ¼llt â€“ Itschana Stil B) -->
      <div class="spenden-block" style="text-align:center; margin-top:2rem;">
        <h3 style="font-weight:600; color:#2a4d45; margin-bottom:0.8rem;">
          Direkte Bank-Ãœberweisung (SEPA)
        </h3>

        <p class="spenden-klein" style="font-size:0.95rem; color:#444; line-height:1.5;">
          Du kannst diesen SEPA-QR mit deiner Banking-App scannen.<br>
          Betrag <strong>45 Euro</strong>, IBAN und Verwendungszweck<br>
          sind automatisch vorausgefÃ¼llt.
        </p>

        <img src="SEPA_Itschana_Weichgold.png"
             alt="SEPA-QR FÃ¶rderbeitrag NK 2026"
             class="qr-code"
             style="width:240px; max-width:80%; border-radius:12px; margin:1.2rem auto;">

        <p class="spenden-klein" style="font-size:0.85rem; color:#555; margin-top:0.5rem;">
          Falls das Scannen nicht funktioniert, findest du hier<br>
          die Daten zum manuellen Eintragen:
        </p>

        <p class="spenden-klein" style="font-size:0.9rem; color:#333; line-height:1.5;">
          <strong>EmpfÃ¤nger:</strong> Verein Reset â€“ ZurÃ¼ck zum Leben als Mensch<br>
          <strong>IBAN:</strong> AT23 1400 0295 1083 5393<br>
          <strong>BIC:</strong> BAWAATWW<br>
          <strong>Betrag:</strong> 45 Euro<br>
          <strong>Verwendungszweck:</strong> â€žNK 2026 â€“ Name + Adresseâ€œ
        </p>
      </div> <!-- Ende SEPA-Block -->
    </div>   <!-- Ende spenden-grid -->

    <p class="spenden-dank">
      Danke fÃ¼r deine UnterstÃ¼tzung â€“ sie macht den Itschana-Weg mÃ¶glich.
    </p>


  <!-- Itschana JSON Loader (einziges aktives System) -->
  <script>
    const FALLBACK_DATE = "2026-01-21";
    let currentISO = null;

    function addDaysISO(iso, delta){
      const d = new Date(iso + "T12:00:00");
      d.setDate(d.getDate() + delta);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function isoTodayLocal(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    async function loadJSON(path){
      const r = await fetch(path, { cache: "no-store" });
      if(!r.ok) throw new Error("Kann JSON nicht laden: " + path);
      return await r.json();
    }

    async function loadDay(dateISO){
      const index = await loadJSON("/data/itschana_index.json");
      const range = index.ranges.find(r => dateISO >= r.from && dateISO <= r.to);
      if(!range) return null;

      const days = await loadJSON("/data/" + range.file);
      return days[dateISO] || null;
    }

    async function showISO(iso){
      const data = await loadDay(iso);
      if(!data){
        alert("FÃ¼r dieses Datum ist noch kein Eintrag vorhanden: " + iso);
        return;
      }
      currentISO = iso;
      renderToExistingFields(data);
    }

    function wireDayNav(){
      const prevBtn = document.getElementById("prev-day");
      const nextBtn = document.getElementById("next-day");

      if(prevBtn){
        prevBtn.onclick = () => {
          if(!currentISO) return;
          showISO(addDaysISO(currentISO, -1));
        };
      }

      if(nextBtn){
        nextBtn.onclick = () => {
          if(!currentISO) return;
          showISO(addDaysISO(currentISO, +1));
        };
      }
    }

    function renderToExistingFields(data){
      const outputEl = document.getElementById("kin-output");
      const linkEl = document.getElementById("kin-link");
      if(!outputEl) return;

      // Link setzen
      const kinLink = data?.links?.kin || (data?.day?.kin
        ? ("https://sonnenkalender.com/kin" + String(data.day.kin).padStart(3,"0") + "/")
        : null);

      if(linkEl && kinLink){
        linkEl.href = kinLink;
      }

      // Render (inkl. Navigation-Buttons IM Block)
      outputEl.innerHTML = `
        <div style="display:flex; gap:0.5rem; justify-content:center; margin:0 0 0.75rem;">
          <button type="button" id="prev-day">â—€ Voriger Tag</button>
          <button type="button" id="next-day">NÃ¤chster Tag â–¶</button>
        </div>

        <div style="border:2px solid #777; padding:0.75rem; border-radius:8px; margin-bottom:0.75rem;">
          <div style="text-align:center; font-weight:bold;">
            ${data.moon?.rangeLabel || ""}
          </div>

          <div style="dispasync function showISO(iso){
  const data = await loadDay(iso);

  // sanft statt alert:
  if(!data){
    currentISO = iso;

    const outputEl = document.getElementById("kin-output");
    if(outputEl){
      outputEl.innerHTML = `
        <div style="display:flex; gap:0.5rem; justify-content:center; margin:0 0 0.75rem;">
          <button type="button" id="prev-day">â—€ Voriger Tag</button>
          <button type="button" id="next-day">NÃ¤chster Tag â–¶</button>
        </div>

        <div style="border:2px dashed #777; padding:1rem; border-radius:10px; text-align:center;">
          <div style="font-weight:bold; margin-bottom:0.5rem;">${iso}</div>
          <div>Noch kein Eintrag fÃ¼r dieses Datum.</div>
        </div>
      `;
      wireDayNav();
    }
    return;
  }

  currentISO = iso;
  renderToExistingFields(data);
}
lay:flex; gap:0.75rem; margin-top:0.6rem;">
            <div style="flex:1; border:1px solid #bbb; padding:0.6rem;">
              <div style="font-weight:bold; margin-bottom:0.25rem;">Mond-KIN</div>
              <div>
                Mondton ${data.moon?.ton?.nr ?? ""} â€“ ${data.moon?.ton?.label ?? ""}${data.moon?.ton?.abbr ? " (" + data.moon.ton.abbr + ")" : ""}
              </div>
            </div>

            <div style="flex:1; border:1px solid #bbb; padding:0.6rem;">
              <div style="font-weight:bold; margin-bottom:0.25rem;">Jahres-KIN</div>
              <div>
                ${data.year?.name ?? ""}${data.year?.tonNr ? " (Ton " + data.year.tonNr + ")" : ""}
              </div>
            </div>
          </div>
        </div>

        <div style="border:2px solid #777; padding:0.75rem; border-radius:8px; margin-bottom:0.75rem;">
          <div style="font-weight:bold;">
            ${data.wave?.rangeLabel || ""}
          </div>
          <div style="margin-top:0.25rem;">
            ${data.wave?.name || ""}
          </div>
        </div>

        <div style="border:3px solid #333; padding:1rem; border-radius:10px;">
          <div style="text-align:center; font-weight:bold; margin-bottom:0.5rem;">
            ${data.dateLabel || ""}
          </div>

          <div style="text-align:center; font-size:1.15rem; font-weight:bold;">
            KIN ${data.day?.kin ?? ""} â€“ ${data.day?.name ?? ""}
          </div>

          <div style="text-align:center; margin-top:0.25rem;">
            Ton ${data.day?.ton?.nr ?? ""} â€“ ${data.day?.ton?.label ?? ""}${data.day?.ton?.phrase ? " (" + data.day.ton.phrase + ")" : ""}
          </div>

          <div style="text-align:center; margin-top:0.25rem;">
            ${data.day?.ton?.ebene ?? ""}
          </div>

          <hr style="margin:0.9rem 0; border:none; border-top:1px solid #bbb;">

          <div><b>Figur:</b> ${data.day?.figur ?? ""}</div>
          <div style="margin-top:0.25rem;"><b>Bestimmung:</b> ${data.day?.rollenfeld ?? ""}</div>
          <div style="margin-top:0.25rem;"><b>Fraktion:</b> ${data.day?.fraktion ?? ""}</div>
        </div>
      `;

      // Nach jedem Render: Buttons neu verdrahten
      wireDayNav();
    }

    (async () => {
      try{
        const today = isoTodayLocal();
        let data = await loadDay(today);
        currentISO = today;

        if(!data){
          data = await loadDay(FALLBACK_DATE);
          currentISO = FALLBACK_DATE;
        }async function showISO(iso){
  const data = await loadDay(iso);

  // sanft statt alert:
  if(!data){
    currentISO = iso;

    const outputEl = document.getElementById("kin-output");
    if(outputEl){
      outputEl.innerHTML = `
        <div style="display:flex; gap:0.5rem; justify-content:center; margin:0 0 0.75rem;">
          <button type="button" id="prev-day">â—€ Voriger Tag</button>
          <button type="button" id="next-day">NÃ¤chster Tag â–¶</button>
        </div>

        <div style="border:2px dashed #777; padding:1rem; border-radius:10px; text-align:center;">
          <div style="font-weight:bold; margin-bottom:0.5rem;">${iso}</div>
          <div>Noch kein Eintrag fÃ¼r dieses Datum.</div>
        </div>
      `;
      wireDayNav();
    }
    return;
  }

  currentISO = iso;
  renderToExistingFields(data);
}



        if(!data) return;

        renderToExistingFields(data);
      } catch(err){
        console.error(err);
      }
    })();
  </script>
</body>
</html>
