<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalender ‚Äì Itschana</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <a href="index.html">Start</a>
    <a href="kalender.html">Kalender</a>
    <a href="webinar.html">Webinar</a>
    <a href="vision.html">Vision</a>
    <a href="kontakt.html">Kontakt</a>
  </nav>

  <main>
    <h1>Kalender der lebendigen Zeit Energien</h1>
    <p>Itschana verbindet den nat√ºrlichen 273er-Zyklus mit dem gregorianischen Jahreslauf und macht innere Rhythmen erfahrbar.</p>

    <section class="kin-feld">
      <h2>Impuls des heutigen Tages</h2>
      <div id="kin-output">Wird geladen ‚Ä¶</div>
      <p><a id="kin-link" href="#" target="_blank">üîó Zur Tagesenergie √∂ffnen</a></p>
    </section>
  </main>

  <section id="spenden" class="spendenbox">
    <h2>F√∂rderbeitrag f√ºr den Nat√ºrlichen Kalender 2026</h2>

    <p class="spenden-einleitung">
      Mit einem F√∂rderbeitrag von <strong>45&nbsp;Euro</strong> unterst√ºtzt du die Entstehung des
      Nat√ºrlichen Kalenders 2026 ‚Äì und erh√§ltst den Kalender als Geschenk zugesendet.
    </p>

    <p class="spenden-hinweis">
      <strong>Verwendungszweck:</strong><br>
      ‚ÄûNK 2026 ‚Äì Name + Adresse‚Äú<br>
      <em>(damit wir den Kalender korrekt zusenden k√∂nnen)</em>
    </p>

    <div class="spenden-grid">
      <!-- Link-QR (√∂ffnet deine Spenden-Webseite) -->
      <div class="spenden-block">
        <h3>Online-Infos & Spendenbereich</h3>
        <p>Dieser QR-Code √∂ffnet den Spendenbereich auf it¬≠schana-start:</p>
        <img src="QR_Foerderbeitrag_Itschana_Spenden.png"
             alt="QR-Code zum Spendenbereich Itschana"
             class="qr-code">
        <p class="spenden-klein">
          Alternativ im Browser: <br>
          <code>itschana-start.vercel.app/#spenden</code>
        </p>
      </div>

      <!-- SEPA-QR (Banking-App vorausgef√ºllt ‚Äì Itschana Stil B) -->
      <div class="spenden-block" style="text-align:center; margin-top:2rem;">
        <h3 style="font-weight:600; color:#2a4d45; margin-bottom:0.8rem;">
          Direkte Bank-√úberweisung (SEPA)
        </h3>

        <p class="spenden-klein" style="font-size:0.95rem; color:#444; line-height:1.5;">
          Du kannst diesen SEPA-QR mit deiner Banking-App scannen.<br>
          Betrag <strong>45 Euro</strong>, IBAN und Verwendungszweck<br>
          sind automatisch vorausgef√ºllt.
        </p>

        <img src="SEPA_Itschana_Weichgold.png"
             alt="SEPA-QR F√∂rderbeitrag NK 2026"
             class="qr-code"
             style="width:240px; max-width:80%; border-radius:12px; margin:1.2rem auto;">

        <p class="spenden-klein" style="font-size:0.85rem; color:#555; margin-top:0.5rem;">
          Falls das Scannen nicht funktioniert, findest du hier<br>
          die Daten zum manuellen Eintragen:
        </p>

        <p class="spenden-klein" style="font-size:0.9rem; color:#333; line-height:1.5;">
          <strong>Empf√§nger:</strong> Verein Reset ‚Äì Zur√ºck zum Leben als Mensch<br>
          <strong>IBAN:</strong> AT23 1400 0295 1083 5393<br>
          <strong>BIC:</strong> BAWAATWW<br>
          <strong>Betrag:</strong> 45 Euro<br>
          <strong>Verwendungszweck:</strong> ‚ÄûNK 2026 ‚Äì Name + Adresse‚Äú
        </p>
      </div> <!-- Ende SEPA-Block -->
    </div>   <!-- Ende spenden-grid -->

    <p class="spenden-dank">
      Danke f√ºr deine Unterst√ºtzung ‚Äì sie macht den Itschana-Weg m√∂glich.
    </p>
  </section>
<script src="kin-daten-komplett.js"></script>
<script>
  (function () {
    // --- Heutiges Datum holen ---
    const jetzt = new Date();

    // --- Itschana-Tageswechsel um 03:08 ---
    const grenze = new Date();
    grenze.setHours(3, 8, 0, 0); // 03:08:00 lokale Zeit

    // Datum, das im Itschana-Kalender z√§hlt
    let itschanaDatum = new Date(jetzt);
    if (jetzt < grenze) {
      // Vor 03:08 -> noch der Vortag
      itschanaDatum.setDate(itschanaDatum.getDate() - 1);
    }

    // Schl√ºssel im Format YYYY-MM-DD f√ºr kinList
    const isoKey = itschanaDatum.toISOString().split("T")[0];

    // --- KIN aus der Verwandtenliste holen ---
    const kinNummer = kinList[isoKey];

    const outputEl = document.getElementById("kin-output");
    const linkEl   = document.getElementById("kin-link");

    // Sicherheitsnetz: falls IDs nicht gefunden werden, einfach abbrechen
    if (!outputEl || !linkEl) {
      return;
    }

    if (kinNummer && kinInfos[kinNummer]) {
      const info = kinInfos[kinNummer];

      outputEl.innerHTML = `
        <div style="background-color:${info.farbe}; padding:1em; border-radius:1em; text-align:center;">
          <img src="bilder/${info.glyphe}" alt="Glyphe" style="height:64px; margin-bottom:0.5em;"><br>
          <strong>KIN ${kinNummer}</strong><br>
          ${info.name}<br>
          ${info.ton} (${info.dimension})<br>
          <em>${info.bestimmung}</em>
        </div>
      `;

      linkEl.href =
        "https://itschana.vercel.app/kin" +
        kinNummer.toString().padStart(3, "0") +
        "/";
    } else {
      outputEl.textContent =
        "F√ºr dieses Datum ist in der Itschana-Verwandtenliste noch kein KIN eingetragen.";
      linkEl.href = "#";
    }
  })();
</script>
 <!-- Itschana JSON Loader (sicher, nutzt bestehende IDs: kin-output / kin-link) -->
<script>
  const FALLBACK_DATE = "2026-01-21";

  function isoTodayLocal(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  async function loadJSON(path){
    const r = await fetch(path, { cache: "no-store" });
    if(!r.ok) throw new Error("Kann JSON nicht laden: " + path);
    return await r.json();
  }

  async function loadDay(dateISO){
    const index = await loadJSON("/data/itschana_index.json");
    const range = index.ranges.find(r => dateISO >= r.from && dateISO <= r.to);
    if(!range) return null;

    const days = await loadJSON("/data/" + range.file);
    return days[dateISO] || null;
  }

  function renderToExistingFields(data){
    const outputEl = document.getElementById("kin-output");
    const linkEl = document.getElementById("kin-link");
    if(!outputEl) return; // wenn Layout anders ist, nichts kaputt machen

    // Link setzen (wenn vorhanden)
    const kinLink = data?.links?.kin || (data?.day?.kin
      ? ("https://sonnenkalender.com/kin" + String(data.day.kin).padStart(3,"0") + "/")
      : null);

    if(linkEl && kinLink){
      linkEl.href = kinLink;
      // falls es ein <a> ohne Text ist:
      if(!linkEl.textContent || !linkEl.textContent.trim()){
        linkEl.textContent = "Zum KIN";
      }
    }

    // Render (minimal, aber vollst√§ndig f√ºr deinen Screenshot-Aufbau)
    outputEl.innerHTML = `
      <div style="border:2px solid #777; padding:0.75rem; border-radius:8px; margin-bottom:0.75rem;">
        <div style="text-align:center; font-weight:bold;">
          ${data.moon?.rangeLabel || ""}
        </div>

        <div style="display:flex; gap:0.75rem; margin-top:0.6rem;">
          <div style="flex:1; border:1px solid #bbb; padding:0.6rem;">
            <div style="font-weight:bold; margin-bottom:0.25rem;">Mond-KIN</div>
            <div>
              Mondton ${data.moon?.ton?.nr ?? ""} ‚Äì ${data.moon?.ton?.label ?? ""}${data.moon?.ton?.abbr ? " ("+data.moon.ton.abbr+")" : ""}
            </div>
          </div>

          <div style="flex:1; border:1px solid #bbb; padding:0.6rem;">
            <div style="font-weight:bold; margin-bottom:0.25rem;">Jahres-KIN</div>
            <div>
              ${data.year?.name ?? ""}${data.year?.tonNr ? " (Ton "+data.year.tonNr+")" : ""}
            </div>
          </div>
        </div>
      </div>

      <div style="border:2px solid #777; padding:0.75rem; border-radius:8px; margin-bottom:0.75rem;">
        <div style="font-weight:bold;">
          ${data.wave?.rangeLabel || ""}
        </div>
        <div style="margin-top:0.25rem;">
          ${data.wave?.name || ""}
        </div>
      </div>

      <div style="border:3px solid #333; padding:1rem; border-radius:10px;">
        <div style="text-align:center; font-weight:bold; margin-bottom:0.5rem;">
          ${data.dateLabel || ""}
        </div>

        <div style="text-align:center; font-size:1.15rem; font-weight:bold;">
          KIN ${data.day?.kin ?? ""} ‚Äì ${data.day?.name ?? ""}
        </div>

        <div style="text-align:center; margin-top:0.25rem;">
          Ton ${data.day?.ton?.nr ?? ""} ‚Äì ${data.day?.ton?.label ?? ""}${data.day?.ton?.phrase ? " ("+data.day.ton.phrase+")" : ""}
        </div>

        <div style="text-align:center; margin-top:0.25rem;">
          ${data.day?.ton?.ebene ?? ""}
        </div>

        <hr style="margin:0.9rem 0; border:none; border-top:1px solid #bbb;">

        <div><b>Figur:</b> ${data.day?.figur ?? ""}</div>
        <div style="margin-top:0.25rem;"><b>Bestimmung:</b> ${data.day?.rollenfeld ?? ""}</div>
        <div style="margin-top:0.25rem;"><b>Fraktion:</b> ${data.day?.fraktion ?? ""}</div>
      </div>
    `;
  }

  (async () => {
    try{
      const today = isoTodayLocal();
      let data = await loadDay(today);

      // Fallback auf Testtag, falls heute noch nicht in der Datei ist
      if(!data){
        data = await loadDay(FALLBACK_DATE);
      }

      // Wenn immer noch nichts: nichts √ºberschreiben (dein altes Script bleibt sichtbar)
      if(!data) return;

      renderToExistingFields(data);
    } catch(err){
      // Fehler still lassen, damit dein bisheriges System weiter l√§uft
      console.error(err);
    }
  })();
</script>
 
</body>
  
